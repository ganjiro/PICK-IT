{% extends 'base.html' %}

{% block content %}
<style>
    #computer {
        display: block;
    }

    @media screen and (max-width: 768px) {
        #computer {
            display: none;
        }
    }

    #telefono {
        display: block;
    }

    @media screen and (min-width: 768px) {
        #telefono {
            display: none;
        }
    }
</style>

<div id="computer"><a href="static/e62ac076009313.5c5ca8e8c4a85.jpg" download>download the zip</a></div>

<div id="telefono">
    <h1>{% block title %} Welcome Lol Picker App {% endblock %}</h1>

    <div class="col-6">
        <label class="form-label">Sync Code <label id="error-code" style="font-size:12px; color:red;"> </label> </label>
        <input type="text" class="form-control" id="id-input" style="text-transform:uppercase"
               style="border-radius: 25px;">
    </div>

    <button id="id-bottone" class="btn btn-primary" type="submit">submit</button>
</div>


<script type="text/javascript">
    $(document).ready(function () {

        $.ajax({
            type: "POST",
            url: "/getcookie",
            data: {},
            dataType: 'JSON',
            success: function (response) {

                if (response["success"]) {

                    document.getElementById("id-input").value = response['code']

                }

            },
            error: function () {


            }
        });

        $("#id-bottone").click(function (e) {

            var bool = true;
            var code = document.getElementById("id-input").value;
            if (code.length === 0) {
                document.getElementById("error-code").innerHTML = "Password errata, ritenta!";
                bool = false;
            } else
                document.getElementById("error-code").innerHTML = "";

            if (bool) {
                $.ajax({
                    type: "POST",
                    url: "/code",
                    data: {id: code},
                    dataType: 'JSON',
                    success: function (response) {

                        console.log("ok")

                        if (response["success"]) {
                            $.ajax({
                                type: "POST",
                                url: "/setcookie",
                                data: {code: code},
                                dataType: 'JSON',
                                success: function () {

                                    console.log("ok")

                                },
                                error: function () {

                                    console.log("diocane")
                                }

                            });
                            window.location.href = '/waiting';
                        }

                    },
                    error: function (response) {
                        console.log(response);
                    }

                });

            }


        });
    })
    ;


</script>

{% endblock %}